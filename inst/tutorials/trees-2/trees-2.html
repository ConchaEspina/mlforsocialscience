<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<meta name="progressive" content="true" />
<meta name="allow-skip" content="false" />

<title>Decision Trees II</title>


<!-- highlightjs -->
<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>

<!-- taken from https://github.com/rstudio/rmarkdown/blob/67b7f5fc779e4cfdfd0f021d3d7745b6b6e17149/inst/rmd/h/default.html#L296-L362 -->
<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>
<!-- end tabsets -->



</head>

<body>



<div class="pageContent band">
<div class="bandContent page">

<div class="topics">

<div id="section-setup" class="section level2">
<h2>Setup</h2>
<pre class="r"><code>library(mlbench)
library(partykit)
library(strucchange)
library(caret)</code></pre>
</div>
<div id="section-data" class="section level2">
<h2>Data</h2>
<p>In this notebook, we use the Boston Housing data set (again). “This dataset contains information collected by the U.S Census Service concerning housing in the area of Boston Mass. It was obtained from the StatLib archive (<a href="http://lib.stat.cmu.edu/datasets/boston" class="uri">http://lib.stat.cmu.edu/datasets/boston</a>), and has been used extensively throughout the literature to benchmark algorithms.”</p>
<p>Source: <a href="https://www.cs.toronto.edu/~delve/data/boston/bostonDetail.html" class="uri">https://www.cs.toronto.edu/~delve/data/boston/bostonDetail.html</a></p>
<pre class="r"><code>data(BostonHousing2)
head(BostonHousing2)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["town"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["tract"],"name":[2],"type":["int"],"align":["right"]},{"label":["lon"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["lat"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["medv"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["cmedv"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["crim"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["zn"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["indus"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["chas"],"name":[10],"type":["fctr"],"align":["left"]},{"label":["nox"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["rm"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["dis"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["rad"],"name":[15],"type":["int"],"align":["right"]},{"label":["tax"],"name":[16],"type":["int"],"align":["right"]},{"label":["ptratio"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["b"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["lstat"],"name":[19],"type":["dbl"],"align":["right"]}],"data":[{"1":"Nahant","2":"2011","3":"-70.9550","4":"42.2550","5":"24.0","6":"24.0","7":"0.00632","8":"18","9":"2.31","10":"0","11":"0.538","12":"6.575","13":"65.2","14":"4.0900","15":"1","16":"296","17":"15.3","18":"396.90","19":"4.98","_rn_":"1"},{"1":"Swampscott","2":"2021","3":"-70.9500","4":"42.2875","5":"21.6","6":"21.6","7":"0.02731","8":"0","9":"7.07","10":"0","11":"0.469","12":"6.421","13":"78.9","14":"4.9671","15":"2","16":"242","17":"17.8","18":"396.90","19":"9.14","_rn_":"2"},{"1":"Swampscott","2":"2022","3":"-70.9360","4":"42.2830","5":"34.7","6":"34.7","7":"0.02729","8":"0","9":"7.07","10":"0","11":"0.469","12":"7.185","13":"61.1","14":"4.9671","15":"2","16":"242","17":"17.8","18":"392.83","19":"4.03","_rn_":"3"},{"1":"Marblehead","2":"2031","3":"-70.9280","4":"42.2930","5":"33.4","6":"33.4","7":"0.03237","8":"0","9":"2.18","10":"0","11":"0.458","12":"6.998","13":"45.8","14":"6.0622","15":"3","16":"222","17":"18.7","18":"394.63","19":"2.94","_rn_":"4"},{"1":"Marblehead","2":"2032","3":"-70.9220","4":"42.2980","5":"36.2","6":"36.2","7":"0.06905","8":"0","9":"2.18","10":"0","11":"0.458","12":"7.147","13":"54.2","14":"6.0622","15":"3","16":"222","17":"18.7","18":"396.90","19":"5.33","_rn_":"5"},{"1":"Marblehead","2":"2033","3":"-70.9165","4":"42.3040","5":"28.7","6":"28.7","7":"0.02985","8":"0","9":"2.18","10":"0","11":"0.458","12":"6.430","13":"58.7","14":"6.0622","15":"3","16":"222","17":"18.7","18":"394.12","19":"5.21","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>names(BostonHousing2)</code></pre>
<pre><code>##  [1] &quot;town&quot;    &quot;tract&quot;   &quot;lon&quot;     &quot;lat&quot;     &quot;medv&quot;    &quot;cmedv&quot;   &quot;crim&quot;   
##  [8] &quot;zn&quot;      &quot;indus&quot;   &quot;chas&quot;    &quot;nox&quot;     &quot;rm&quot;      &quot;age&quot;     &quot;dis&quot;    
## [15] &quot;rad&quot;     &quot;tax&quot;     &quot;ptratio&quot; &quot;b&quot;       &quot;lstat&quot;</code></pre>
<p>We start by splitting the data into a training and test set with <code>sample</code>.</p>
<pre class="r"><code>set.seed(7345)
train &lt;- sample(1:nrow(BostonHousing2), 0.8*nrow(BostonHousing2))
boston_train &lt;- BostonHousing2[train,]
boston_test &lt;- BostonHousing2[-train,]</code></pre>
</div>
<div id="section-ctree" class="section level2">
<h2>CTREE</h2>
<p>In order to grow a conditional inference tree, we use the <code>ctree</code> function. We begin with the default setup and plot the resulting object.</p>
<pre class="r"><code>ct1 &lt;- ctree(medv ~ . - town - tract - cmedv,
             data = boston_train)
ct1</code></pre>
<pre><code>## 
## Model formula:
## medv ~ lon + lat + crim + zn + indus + chas + nox + rm + age + 
##     dis + rad + tax + ptratio + b + lstat
## 
## Fitted party:
## [1] root
## |   [2] lstat &lt;= 9.71
## |   |   [3] rm &lt;= 6.939
## |   |   |   [4] crim &lt;= 1.05393
## |   |   |   |   [5] rm &lt;= 6.54
## |   |   |   |   |   [6] rm &lt;= 6.041: 20.094 (n = 18, err = 103.4)
## |   |   |   |   |   [7] rm &gt; 6.041
## |   |   |   |   |   |   [8] tax &lt;= 348: 24.027 (n = 44, err = 298.3)
## |   |   |   |   |   |   [9] tax &gt; 348: 21.429 (n = 7, err = 39.4)
## |   |   |   |   [10] rm &gt; 6.54
## |   |   |   |   |   [11] lstat &lt;= 5.68: 29.559 (n = 17, err = 154.8)
## |   |   |   |   |   [12] lstat &gt; 5.68: 26.552 (n = 25, err = 158.5)
## |   |   |   [13] crim &gt; 1.05393: 31.900 (n = 7, err = 925.8)
## |   |   [14] rm &gt; 6.939
## |   |   |   [15] rm &lt;= 7.42: 33.571 (n = 35, err = 816.3)
## |   |   |   [16] rm &gt; 7.42
## |   |   |   |   [17] rad &lt;= 4: 43.871 (n = 7, err = 104.8)
## |   |   |   |   [18] rad &gt; 4: 45.069 (n = 16, err = 781.6)
## |   [19] lstat &gt; 9.71
## |   |   [20] lstat &lt;= 16.03
## |   |   |   [21] b &lt;= 131.42: 15.857 (n = 7, err = 102.7)
## |   |   |   [22] b &gt; 131.42
## |   |   |   |   [23] ptratio &lt;= 18.6
## |   |   |   |   |   [24] rm &lt;= 6.129: 20.503 (n = 32, err = 239.3)
## |   |   |   |   |   [25] rm &gt; 6.129: 24.460 (n = 10, err = 180.4)
## |   |   |   |   [26] ptratio &gt; 18.6
## |   |   |   |   |   [27] lstat &lt;= 14.37: 20.338 (n = 50, err = 232.8)
## |   |   |   |   |   [28] lstat &gt; 14.37: 17.129 (n = 14, err = 38.5)
## |   |   [29] lstat &gt; 16.03
## |   |   |   [30] crim &lt;= 5.66637
## |   |   |   |   [31] age &lt;= 84.7: 20.233 (n = 9, err = 91.5)
## |   |   |   |   [32] age &gt; 84.7: 15.964 (n = 47, err = 397.7)
## |   |   |   [33] crim &gt; 5.66637
## |   |   |   |   [34] crim &lt;= 14.0507: 12.964 (n = 39, err = 284.2)
## |   |   |   |   [35] crim &gt; 14.0507: 8.850 (n = 20, err = 125.1)
## 
## Number of inner nodes:    17
## Number of terminal nodes: 18</code></pre>
<pre class="r"><code>plot(ct1, gp = gpar(fontsize = 6), tp_args = list(mainlab=&quot;&quot;))</code></pre>
<p><img src="trees-2_files/figure-html/unnamed-chunk-4-1.png" width="624" /></p>
<p>In order to get a somewhat smaller tree (which is hopefully easier to plot), we can set higher thresholds for splitting a node and also adjust tree depth.</p>
<pre class="r"><code>ct2 &lt;- ctree(medv ~ . - town - tract - cmedv,
             data = boston_train, 
             mincriterion = 0.999, # 1-p threshold for splitting 
             minbucket = 20, # min number of observations per node 
             maxdepth = 3) # max tree depth
ct2</code></pre>
<pre><code>## 
## Model formula:
## medv ~ lon + lat + crim + zn + indus + chas + nox + rm + age + 
##     dis + rad + tax + ptratio + b + lstat
## 
## Fitted party:
## [1] root
## |   [2] lstat &lt;= 9.71
## |   |   [3] rm &lt;= 6.939
## |   |   |   [4] crim &lt;= 0.19802: 24.533 (n = 94, err = 1400.5)
## |   |   |   [5] crim &gt; 0.19802: 27.183 (n = 24, err = 1455.7)
## |   |   [6] rm &gt; 6.939
## |   |   |   [7] rm &lt;= 7.42: 33.571 (n = 35, err = 816.3)
## |   |   |   [8] rm &gt; 7.42: 44.704 (n = 23, err = 893.3)
## |   [9] lstat &gt; 9.71
## |   |   [10] lstat &lt;= 16.03: 20.074 (n = 113, err = 1241.3)
## |   |   [11] lstat &gt; 16.03
## |   |   |   [12] crim &lt;= 5.66637: 16.650 (n = 56, err = 626.8)
## |   |   |   [13] crim &gt; 5.66637: 11.569 (n = 59, err = 633.1)
## 
## Number of inner nodes:    6
## Number of terminal nodes: 7</code></pre>
<pre class="r"><code>plot(ct2, gp = gpar(fontsize = 8), tp_args = list(mainlab=&quot;&quot;))</code></pre>
<p><img src="trees-2_files/figure-html/unnamed-chunk-5-1.png" width="624" /></p>
<p>The <code>sctest</code> function is useful to get a better understanding of how the tree was grown. It lists the results of the permutation tests for each node.</p>
<pre class="r"><code>sctest(ct2)</code></pre>
<pre><code>## $`1`
##                    lon       lat         crim           zn        indus
## statistic 4.231800e+01 0.5349822 6.258901e+01 4.300729e+01 9.515652e+01
## p.value   1.163629e-09 0.9999147 3.820062e-14 8.180451e-10 2.638679e-21
##                 chas          nox           rm          age          dis
## statistic 9.36708738 7.608321e+01 2.091162e+02 4.963845e+01 2.291381e+01
## p.value   0.03262987 4.079389e-17 3.212082e-46 2.772823e-11 2.541423e-05
##                    rad          tax      ptratio            b        lstat
## statistic 6.993380e+01 9.826895e+01 1.157638e+02 4.748809e+01 2.256314e+02
## p.value   9.199282e-16 5.478732e-22 8.031366e-26 8.300851e-11 8.020428e-50
## 
## $`2`
##                    lon       lat         crim        zn     indus       chas
## statistic 13.314906753 0.6354861 13.647931719 0.1018622 0.6301267 9.68477141
## p.value    0.003942295 0.9997539  0.003302161 1.0000000 0.9997662 0.02751064
##                  nox           rm          age          dis       rad       tax
## statistic 9.79590759 1.099802e+02 17.180068312 2.278279e+01 5.7086770 0.5342307
## p.value   0.02591632 1.484644e-24  0.000509856 2.720705e-05 0.2253783 0.9999154
##                ptratio         b        lstat
## statistic 3.107845e+01 2.5474334 6.382296e+01
## p.value   3.717109e-07 0.8272641 2.041763e-14
## 
## $`3`
##                 lon       lat         crim        zn     indus         chas
## statistic 5.1950403 0.3912650 3.031414e+01 0.1761023 1.8308964 11.886017593
## p.value   0.2908433 0.9999886 5.511572e-07 1.0000000 0.9452056  0.008450034
##                 nox           rm       age        dis          rad       tax
## statistic 2.0699802 2.928953e+01 3.2020429 9.65416295 2.450924e+01 5.4886662
## p.value   0.9129896 9.349743e-07 0.6820525 0.02796673 1.109310e-05 0.2516506
##            ptratio         b        lstat
## statistic 2.329569 2.8857707 14.595062624
## p.value   0.869478 0.7544368  0.001997085
## 
## $`4`
## NULL
## 
## $`5`
## NULL
## 
## $`6`
##                 lon        lat      crim        zn     indus      chas
## statistic 0.3888613 0.00694544 0.4028103 0.4457839 1.9694467 0.3821196
## p.value   0.9999890 1.00000000 0.9999861 0.9999732 0.9275131 0.9999902
##                 nox           rm       age       dis       rad       tax
## statistic 2.7372335 1.760084e+01 2.7989831 5.0150342 0.4810811 0.7327604
## p.value   0.7872596 4.086243e-04 0.7737482 0.3173265 0.9999564 0.9994263
##              ptratio         b        lstat
## statistic 8.71348182 0.6482492 11.823676263
## p.value   0.04634641 0.9997226  0.008736521
## 
## $`7`
## NULL
## 
## $`8`
## NULL
## 
## $`9`
##                    lon       lat         crim        zn        indus      chas
## statistic 1.671868e+01 2.3978626 6.370850e+01 6.7114248 3.665811e+01 5.0564923
## p.value   6.500823e-04 0.8567423 2.163914e-14 0.1344485 2.111580e-08 0.3110573
##                    nox        rm          age          dis          rad
## statistic 4.390107e+01 4.2397919 4.742397e+01 2.531454e+01 4.977356e+01
## p.value   5.180994e-10 0.4535522 8.576859e-11 7.305311e-06 2.588305e-11
##                    tax      ptratio            b        lstat
## statistic 6.123019e+01 3.103603e+01 2.889567e+01 9.946669e+01
## p.value   7.616518e-14 3.799236e-07 1.145754e-06 2.992360e-22
## 
## $`10`
##                  lon       lat       crim        zn     indus      chas
## statistic 8.03117900 0.1472208 10.4045762 0.2513234 4.3662017 0.2675198
## p.value   0.06679221 1.0000000  0.0186905 0.9999994 0.4289117 0.9999991
##                 nox        rm       age     dis       rad       tax     ptratio
## statistic 2.6026771 1.4455727 2.8179726 0.15662 3.0371252 6.9444810 10.51346992
## p.value   0.8158884 0.9798725 0.7695527 1.00000 0.7200767 0.1189585  0.01762942
##                     b      lstat
## statistic 10.77901055 8.47371269
## p.value    0.01528847 0.05270516
## 
## $`11`
##                 lon       lat         crim        zn       indus         chas
## statistic 6.8865136 4.6082522 3.498359e+01 1.5500251 10.82775689 14.264511416
## p.value   0.1226434 0.3843242 4.987443e-08 0.9725507  0.01489393  0.002379825
##                    nox        rm          age          dis          rad
## statistic 2.224360e+01 1.4654305 13.969944860 2.102674e+01 2.393740e+01
## p.value   3.602307e-05 0.9785937  0.002782726 6.793567e-05 1.492784e-05
##                    tax   ptratio          b        lstat
## statistic 2.980770e+01 8.1350052 8.04020711 1.963446e+01
## p.value   7.156395e-07 0.0631854 0.06647069 1.406346e-04
## 
## $`12`
## NULL
## 
## $`13`
## NULL</code></pre>
</div>
<div id="section-model-based-recursive-partitioning" class="section level2">
<h2>Model-based recursive partitioning</h2>
<p>In model-based recursive partitioning, we begin with a prespecified model and define a set of partitioning variables. Here we follow the example of the <code>partykit</code> vignette.</p>
<p><a href="https://cran.r-project.org/web/packages/partykit/vignettes/mob.pdf" class="uri">https://cran.r-project.org/web/packages/partykit/vignettes/mob.pdf</a></p>
<pre class="r"><code>tree1 &lt;- lmtree(medv ~ log(lstat) + I(rm^2) | 
                zn + indus + chas + nox + age + dis + rad + tax + crim + b + ptratio, 
                data = boston_train, 
                verbose = TRUE)</code></pre>
<pre><code>## 
## -- Node 1 ---------------------------------
## Number of observations: 404
## 
## Parameter instability tests:
##                     zn        indus         chas          nox          age
## statistic 2.974164e+01 7.027228e+01 2.193377e+01 9.086082e+01 3.550543e+01
## p.value   6.499666e-04 1.069740e-12 7.406746e-04 2.482002e-17 4.137136e-05
##                    dis          rad          tax         crim            b
## statistic 5.417700e+01 8.943984e+01 8.913332e+01 8.934208e+01 4.074967e+01
## p.value   3.941236e-09 5.206504e-17 6.108296e-17 5.478659e-17 3.204056e-06
##                ptratio
## statistic 6.300994e+01
## p.value   4.429860e-11
## 
## Best splitting variable: nox
## Perform split? yes
## Selected split: &lt;= 0.655 | &gt; 0.655
## 
## -- Node 2 ---------------------------------
## Number of observations: 319
## 
## Parameter instability tests:
##                   zn        indus         chas          nox          age
## statistic 16.8890221 4.300407e+01 2.549468e+01 4.098774e+01 3.566411e+01
## p.value    0.1889405 1.062252e-06 1.338409e-04 2.871622e-06 3.859547e-05
##                    dis          rad          tax         crim          b
## statistic 4.910355e+01 4.328513e+01 4.569381e+01 4.928032e+01 18.3052555
## p.value   5.099578e-08 9.243843e-07 2.797769e-07 4.667400e-08  0.1087657
##                ptratio
## statistic 4.770353e+01
## p.value   1.027255e-07
## 
## Best splitting variable: crim
## Perform split? yes
## Selected split: &lt;= 1.05393 | &gt; 1.05393
## 
## -- Node 3 ---------------------------------
## Number of observations: 267
## 
## Parameter instability tests:
##                   zn        indus        chas      nox        age        dis
## statistic 13.3582525 25.541178885 12.12692303 9.170849 18.5475424 14.5101250
## p.value    0.5647375  0.004276444  0.07395862 0.984314  0.0926372  0.4081224
##                  rad          tax       crim         b      ptratio
## statistic 12.9250411 3.909299e+01 18.1304195 5.9323007 4.148409e+01
## p.value    0.6273375 6.591504e-06  0.1097419 0.9999993 2.031140e-06
## 
## Best splitting variable: ptratio
## Perform split? yes
## Selected split: &lt;= 19.2 | &gt; 19.2
## 
## -- Node 4 ---------------------------------
## Number of observations: 208
## 
## Parameter instability tests:
##                  zn      indus      chas        nox       age         dis
## statistic 11.229973 16.3342585 5.6710717 20.7139864 8.8307633 21.32474148
## p.value    0.811734  0.1877912 0.7804512  0.0297877 0.9847568  0.02265297
##                  rad          tax       crim         b    ptratio
## statistic 12.8857866 3.414821e+01 15.5260946 6.0582767 21.1252888
## p.value    0.5800384 4.925917e-05  0.2539324 0.9999935  0.0247795
## 
## Best splitting variable: tax
## Perform split? yes
## Selected split: &lt;= 265 | &gt; 265
## 
## -- Node 5 ---------------------------------
## Number of observations: 68
## 
## Parameter instability tests:
##                  zn      indus      chas        nox       age         dis
## statistic 4.9056390 14.0418388 1.1397076 11.9978370 11.255685 14.82940797
## p.value   0.9953219  0.1154255 0.9999999  0.2526893  0.327784  0.08380598
##                 rad       tax      crim         b    ptratio
## statistic 5.2100164 8.9509241 6.1638978 4.2317308 12.2649729
## p.value   0.9911429 0.6420343 0.9589821 0.9992027  0.2292377
## 
## Best splitting variable: dis
## Perform split? no
## 
## -- Node 6 ---------------------------------
## Number of observations: 140
## 
## Parameter instability tests:
##                  zn      indus      chas       nox        age       dis
## statistic 7.5362426 12.2709845 9.1766081 9.6260145 15.8349937 10.418992
## p.value   0.9951008  0.5747897 0.2602568 0.9095635  0.1796751  0.829733
##                 rad         tax       crim         b    ptratio
## statistic 6.3615373 18.54554465 11.1115177 7.2447439 16.1287808
## p.value   0.9997555  0.05991724  0.7412672 0.9973679  0.1604782
## 
## Best splitting variable: tax
## Perform split? no
## 
## -- Node 7 ---------------------------------
## Number of observations: 59
## Too few observations, stop splitting (minsize = 30)
## 
## -- Node 8 ---------------------------------
## Number of observations: 52
## Too few observations, stop splitting (minsize = 30)
## 
## -- Node 9 ---------------------------------
## Number of observations: 85
## 
## Parameter instability tests:
##           zn     indus      chas       nox      age        dis       rad
## statistic  0 4.0880824 0.8345928 7.9254599 2.030444 12.6961687 7.2246802
## p.value   NA 0.9999867 1.0000000 0.9115602 1.000000  0.3070139 0.9586444
##                 tax       crim        b   ptratio
## statistic 7.2246802 12.1893505 2.331209 7.2246802
## p.value   0.9586444  0.3625382 1.000000 0.9586444
## 
## Best splitting variable: dis
## Perform split? no</code></pre>
<pre class="r"><code>plot(tree1, gp = gpar(fontsize = 9))</code></pre>
<p><img src="trees-2_files/figure-html/unnamed-chunk-7-1.png" width="624" /></p>
<p>A brief summary of the model-based tree.</p>
<pre class="r"><code>tree1</code></pre>
<pre><code>## Linear model tree
## 
## Model formula:
## medv ~ log(lstat) + I(rm^2) | zn + indus + chas + nox + age + 
##     dis + rad + tax + crim + b + ptratio
## 
## Fitted party:
## [1] root
## |   [2] nox &lt;= 0.655
## |   |   [3] crim &lt;= 1.05393
## |   |   |   [4] ptratio &lt;= 19.2
## |   |   |   |   [5] tax &lt;= 265: n = 68
## |   |   |   |       (Intercept)  log(lstat)     I(rm^2) 
## |   |   |   |         2.5511422  -2.8809561   0.7335316 
## |   |   |   |   [6] tax &gt; 265: n = 140
## |   |   |   |       (Intercept)  log(lstat)     I(rm^2) 
## |   |   |   |        -0.7012976  -0.7700900   0.6558100 
## |   |   |   [7] ptratio &gt; 19.2: n = 59
## |   |   |       (Intercept)  log(lstat)     I(rm^2) 
## |   |   |        19.2425270  -5.1646802   0.3348568 
## |   |   [8] crim &gt; 1.05393: n = 52
## |   |       (Intercept)  log(lstat)     I(rm^2) 
## |   |        49.7031415 -13.6991819   0.1865616 
## |   [9] nox &gt; 0.655: n = 85
## |       (Intercept)  log(lstat)     I(rm^2) 
## |        52.7008704 -11.9031977  -0.1083862 
## 
## Number of inner nodes:    4
## Number of terminal nodes: 5
## Number of parameters per node: 3
## Objective function (residual sum of squares): 4334.23</code></pre>
<p>A more detailed summary of the model in node 1 (root node).</p>
<pre class="r"><code>summary(tree1, node = 1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ log(lstat) + I(rm^2))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -19.2814  -2.8167  -0.4815   2.2844  27.2309 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 29.92461    2.42545  12.338   &lt;2e-16 ***
## log(lstat)  -9.01564    0.51758 -17.419   &lt;2e-16 ***
## I(rm^2)      0.34084    0.03528   9.661   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.663 on 401 degrees of freedom
## Multiple R-squared:  0.7376, Adjusted R-squared:  0.7363 
## F-statistic: 563.7 on 2 and 401 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Model coefficients for all terminal nodes.</p>
<pre class="r"><code>coef(tree1) </code></pre>
<pre><code>##   (Intercept) log(lstat)    I(rm^2)
## 5   2.5511422  -2.880956  0.7335316
## 6  -0.7012976  -0.770090  0.6558100
## 7  19.2425270  -5.164680  0.3348568
## 8  49.7031415 -13.699182  0.1865616
## 9  52.7008704 -11.903198 -0.1083862</code></pre>
<p>Extract log-Likehood and Information Criteria.</p>
<pre class="r"><code>logLik(tree1)</code></pre>
<pre><code>## &#39;log Lik.&#39; -1025.574 (df=24)</code></pre>
<pre class="r"><code>AIC(tree1)</code></pre>
<pre><code>## [1] 2099.148</code></pre>
<pre class="r"><code>BIC(tree1)</code></pre>
<pre><code>## [1] 2195.182</code></pre>
<p>Now, lets grow a larger tree by adjusting the <code>lmtree</code> arguments.</p>
<pre class="r"><code>tree2 &lt;- lmtree(medv ~ log(lstat) + I(rm^2) | 
                zn + indus + chas + nox + age + dis + rad + tax + crim + b + ptratio, 
                data = boston_train,
                alpha = 0.5, # default significance level = 0.05
                minsize = NULL, # default: min. (10*no. of parameters) observations per node
                maxdepth = Inf) # default: Infinity
plot(tree2, gp = gpar(fontsize = 8))</code></pre>
<p><img src="trees-2_files/figure-html/unnamed-chunk-12-1.png" width="624" /></p>
<p>We can also have a look at the AIC from both trees.</p>
<pre class="r"><code>AIC(tree1)</code></pre>
<pre><code>## [1] 2099.148</code></pre>
<pre class="r"><code>AIC(tree2)</code></pre>
<pre><code>## [1] 2067.714</code></pre>
</div>
<div id="section-prediction" class="section level2">
<h2>Prediction</h2>
<p>Finally, CTREE and MOB results can also be used for prediction.</p>
<pre class="r"><code>y_ct1 &lt;- predict(ct1, newdata = boston_test)
y_ct2 &lt;- predict(ct2, newdata = boston_test)
y_tree1 &lt;- predict(tree1, newdata = boston_test)
y_tree2 &lt;- predict(tree2, newdata = boston_test)</code></pre>
<p>Lets see how well our conditional inference trees and model-based trees are able to predict the outcome in the test set. This time we use <code>postResample</code> to quickly get some useful performance metrics.</p>
<pre class="r"><code>postResample(pred = y_ct1, obs = boston_test$medv)</code></pre>
<pre><code>##      RMSE  Rsquared       MAE 
## 4.6812116 0.7749252 3.0951101</code></pre>
<pre class="r"><code>postResample(pred = y_ct2, obs = boston_test$medv)</code></pre>
<pre><code>##      RMSE  Rsquared       MAE 
## 5.1072887 0.7350706 3.2857464</code></pre>
<pre class="r"><code>postResample(pred = y_tree1, obs = boston_test$medv)</code></pre>
<pre><code>##      RMSE  Rsquared       MAE 
## 4.3901573 0.8026794 2.6445962</code></pre>
<pre class="r"><code>postResample(pred = y_tree2, obs = boston_test$medv)</code></pre>
<pre><code>##      RMSE  Rsquared       MAE 
## 4.4912556 0.7942724 2.8107492</code></pre>
<p>Note that with model-based recursive partitioning, we can also predict node membership.</p>
<pre class="r"><code>y_tree2n &lt;- predict(tree1, newdata = boston_test, type = &quot;node&quot;)
table(y_tree2n)</code></pre>
<pre><code>## y_tree2n
##  5  6  7  8  9 
## 16 34 17 14 21</code></pre>
</div>
<div id="section-references" class="section level2">
<h2>References</h2>
<ul>
<li><a href="https://cran.r-project.org/web/packages/partykit/" class="uri">https://cran.r-project.org/web/packages/partykit/</a> <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/cerulean.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["pagedtable"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pagedtable-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/pagedtable.js"]},{"type":"character","attributes":{},"value":["css/pagedtable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["textmate.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.10.1.9006"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9006"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.10.1.9006"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9006"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.10.1.9006"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9006"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-format"]},{"type":"character","attributes":{},"value":["0.10.1.9006"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmarkdown/templates/tutorial/resources"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-format.js"]},{"type":"character","attributes":{},"value":["tutorial-format.css","rstudio-theme.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9006"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.3"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90]}},"value":[{"type":"character","attributes":{},"value":["backports","base","caret","class","codetools","colorspace","compiler","crayon","curl","data.table","datasets","digest","dplyr","ellipsis","evaluate","fastmap","foreach","Formula","generics","ggplot2","glue","gower","graphics","grDevices","grid","gtable","htmltools","htmlwidgets","httpuv","inum","ipred","iterators","jsonlite","knitr","later","lattice","lava","learnr","libcoin","lifecycle","lubridate","magrittr","markdown","MASS","Matrix","methods","mime","mlbench","ModelMetrics","munsell","mvtnorm","nlme","nnet","partykit","pillar","pkgconfig","plyr","pROC","prodlim","promises","purrr","R6","Rcpp","recipes","reshape2","rlang","rmarkdown","rpart","rprojroot","sandwich","scales","shiny","splines","stats","stats4","stringi","stringr","strucchange","survival","tibble","tidyselect","timeDate","tools","utils","vctrs","withr","xfun","xtable","yaml","zoo"]},{"type":"character","attributes":{},"value":["1.1.9","3.6.3","6.0-86","7.3-15","0.2-16","1.4-1","3.6.3","1.3.4","4.3","1.13.0","3.6.3","0.6.25","1.0.2","0.3.1","0.14","1.0.1","1.4.8","1.2-3","0.0.2","3.3.2","1.4.2","0.2.1","3.6.3","3.6.3","3.6.3","0.3.0","0.5.0.9000","1.5.1","1.5.4","1.0-1","0.9-9","1.0.12","1.7.1","1.29","1.1.0.1","0.20-40","1.6.6","0.10.1.9006","1.0-6","0.2.0","1.7.9","1.5","1.1","7.3-51.5","1.2-18","3.6.3","0.9","2.1-1","1.2.2.2","0.5.0","1.1-1","3.1-145","7.3-13","1.2-9","1.4.6","2.0.3","1.8.6","1.16.2","2019.11.13","1.1.1","0.3.4","2.4.1","1.0.5","0.1.10","1.4.3","0.4.7","2.3","4.1-15","1.3-2","2.5-1","1.1.1","1.5.0","3.6.3","3.6.3","3.6.3","1.5.3","1.4.0","1.5-2","3.1-11","3.0.3","1.1.0","3043.102","3.6.3","3.6.3","0.3.4","2.2.0","0.17","1.8-4","2.2.1","1.8-7"]}]}]}
</script>
<!--/html_preserve--></li>
</ul>
</div>

</div> <!-- topics -->

<div class="topicsContainer">
<div class="topicsPositioner">
<div class="band">
<div class="bandContent topicsListContainer">

<!-- begin doc-metadata -->
<div id="doc-metadata">
<h2 class="title toc-ignore" style="display:none;">Decision Trees II</h2>
</div>
<!-- end doc-metadata -->

</div> <!-- bandContent.topicsListContainer -->
</div> <!-- band -->
</div> <!-- topicsPositioner -->
</div> <!-- topicsContainer -->


</div> <!-- bandContent page -->
</div> <!-- pageContent band -->




<script>
// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>


</body>

</html>
